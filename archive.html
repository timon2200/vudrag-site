<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Archive | Protected Access</title>
    <link rel="stylesheet" href="/src/styles/design-system.css">
    <style>
        body {
            background-color: #050508;
            color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: 'Inter', sans-serif;
            text-align: center;
        }

        .archive-status {
            color: #c9a77a;
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .archive-note {
            opacity: 0.6;
            max-width: 400px;
            line-height: 1.6;
        }

        .logout-btn {
            margin-top: 2rem;
            padding: 0.8rem 1.5rem;
            background: transparent;
            border: 1px solid rgba(201, 167, 122, 0.4);
            color: #c9a77a;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            border-color: #c9a77a;
            background: rgba(201, 167, 122, 0.1);
        }
    </style>
</head>

<body>
    <div class="archive-status">Authorized Personnel Only</div>
    <h1>The Archive</h1>
    <p class="archive-note">Welcome to the private vault. Access granted via secure credentials.</p>

    <button class="logout-btn" onclick="togglePasswordForm()">Change Password</button>
    <button class="logout-btn" onclick="logout()">Close Archives</button>

    <!-- Change Password Form -->
    <div id="password-form"
        style="display: none; margin-top: 2rem; background: rgba(255, 255, 255, 0.05); padding: 2rem; border: 1px solid rgba(201, 167, 122, 0.2); border-radius: 4px;">
        <h3 style="color: #c9a77a; margin-bottom: 1rem; font-family: 'Cormorant Garamond', serif;">Update Credentials
        </h3>
        <form onsubmit="changePassword(event)" style="display: flex; flex-direction: column; gap: 1rem; width: 300px;">
            <input type="password" id="current-password" placeholder="Current Password" required
                style="padding: 0.8rem; background: rgba(0,0,0,0.3); border: 1px solid #333; color: white;">
            <input type="password" id="new-password" placeholder="New Password" required
                style="padding: 0.8rem; background: rgba(0,0,0,0.3); border: 1px solid #333; color: white;">
            <button type="submit"
                style="padding: 0.8rem; background: #c9a77a; color: black; border: none; cursor: pointer; font-weight: bold;">Update</button>
        </form>
        <p id="password-msg" style="margin-top: 1rem; font-size: 0.9rem;"></p>
    </div>

    <script>
        // Basic protection check
        const token = localStorage.getItem('vudrag_token');
        if (!token) {
            window.location.href = '/login.html';
        }

        function logout() {
            localStorage.removeItem('vudrag_token');
            localStorage.removeItem('vudrag_user');
            window.location.href = '/login.html';
        }

        function togglePasswordForm() {
            const form = document.getElementById('password-form');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }

        async function changePassword(e) {
            e.preventDefault();
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const msg = document.getElementById('password-msg');

            msg.textContent = 'Updating...';
            msg.style.color = '#ccc';

            try {
                const res = await fetch('/api/change-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ currentPassword, newPassword })
                });

                const data = await res.json();

                if (res.ok) {
                    msg.textContent = 'Password updated successfully.';
                    msg.style.color = '#c9a77a';
                    document.getElementById('current-password').value = '';
                    document.getElementById('new-password').value = '';
                    setTimeout(() => {
                        document.getElementById('password-form').style.display = 'none';
                        msg.textContent = '';
                    }, 2000);
                } else {
                    msg.textContent = data.error || 'Failed to update password';
                    msg.style.color = '#ff6b6b';
                }
            } catch (err) {
                msg.textContent = 'Server error';
                msg.style.color = '#ff6b6b';
            }
        }
    </script>
</body>

</html>